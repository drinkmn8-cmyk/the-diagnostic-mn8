<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Diagnostic — Q1</title>
    <link rel="stylesheet" href="assets/style.css?v=5" />
  </head>

  <body>
    <main class="wrap">
      <section class="card form-card" role="region" aria-label="Diagnostic Question 1">
        <header class="header left">
          <div class="kicker">DIAGNOSTIC · Q1</div>
          <h1 class="title small">What changed most?</h1>
        </header>

        <form id="q1Form" class="form" novalidate>
          <div class="q">
            <div class="options">
              <div class="opt">
                <input class="radio" type="radio" id="q1_a" name="q1" value="consistency" />
                <label for="q1_a">Consistency</label>
              </div>

              <div class="opt">
                <input class="radio" type="radio" id="q1_b" name="q1" value="confidence" />
                <label for="q1_b">Confidence</label>
              </div>

              <div class="opt">
                <input class="radio" type="radio" id="q1_c" name="q1" value="mental_effort" />
                <label for="q1_c">Mental effort</label>
              </div>

              <div class="opt">
                <input class="radio" type="radio" id="q1_d" name="q1" value="identity" />
                <label for="q1_d">Identity</label>
              </div>

              <div class="opt">
                <input class="radio" type="radio" id="q1_e" name="q1" value="other" />
                <label for="q1_e">Other</label>
              </div>

              <div id="otherWrap" class="otherWrap">
                <div class="field">
                  <label class="label" for="q1_other">Specify</label>
                  <input class="input otherInput" id="q1_other" type="text" placeholder="Type here…" />
                </div>
              </div>
            </div>
          </div>

          <div class="actions row q-actions">
            <button class="ghost" type="button" id="backBtn">Back</button>
            <button id="continueBtn" class="btn" type="submit" disabled>Continue</button>
          </div>
        </form>
      </section>
    </main>

    <script>
      const PREV_PAGE = "diagnostic.html";
      const NEXT_PAGE = "q2.html"; // next step

      const backBtn = document.getElementById("backBtn");
      const continueBtn = document.getElementById("continueBtn");
      const form = document.getElementById("q1Form");
      const otherWrap = document.getElementById("otherWrap");
      const otherInput = document.getElementById("q1_other");

      function selectedValue() {
        const el = document.querySelector('input[name="q1"]:checked');
        return el ? el.value : null;
      }

      function updateUI() {
        const v = selectedValue();
        const isOther = v === "other";

        otherWrap.classList.toggle("show", isOther);

        // continue enabled if selected + (if other, has text)
        const ok =
          !!v && (!isOther || (otherInput.value || "").trim().length > 1);

        continueBtn.disabled = !ok;
      }

      document.querySelectorAll('input[name="q1"]').forEach((r) => {
        r.addEventListener("change", updateUI);
      });
      otherInput.addEventListener("input", updateUI);

      backBtn.addEventListener("click", () => {
        window.location.href = PREV_PAGE;
      });

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        updateUI();
        if (continueBtn.disabled) return;

        const v = selectedValue();
        const payload = {
          value: v,
          other: v === "other" ? otherInput.value.trim() : "",
          ts: Date.now(),
        };

        localStorage.setItem("mn8_q1", JSON.stringify(payload));
        window.location.href = NEXT_PAGE;
      });

      updateUI();
    </script>
  </body>
</html>
